# whisperx_Sub

![GitHub stars](https://img.shields.io/github/stars/hiddenblue/whisperx_Sub?style=social)
![GitHub forks](https://img.shields.io/github/forks/hiddenblue/whisperx_Sub?style=social)
![GitHub watchers](https://img.shields.io/github/watchers/hiddenblue/whisperx_Sub?style=social)
![GitHub repo size](https://img.shields.io/github/repo-size/hiddenblue/whisperx_Sub?)
![GitHub last commit](https://img.shields.io/github/last-commit/hiddenblue/whisperx_Sub?color=red)
[![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2Fhiddenblue%2Fwhisperx_Sub&count_bg=%2379C83D&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=false)](https://hits.seeyoufarm.com)

Whisperx_sub æ˜¯ä¸€ä¸ªåŸºäºWhisperxçš„è§†é¢‘å¬å†™å’Œç¿»è¯‘çš„å­—å¹•ç”Ÿæˆå·¥å…·

## ç‰¹æ€§ï¼š

- å‡­å€Ÿ[Faster whisper](https://github.com/guillaumekln/faster-whisper)è¯­éŸ³æ¨¡å‹,èƒ½å¤Ÿæœ€å¤š60xäºåŸç‰ˆwhisperçš„é€Ÿåº¦ç”Ÿæˆè‹±æ–‡å­—å¹•, 30åˆ†é’Ÿè§†é¢‘åªéœ€è¦1-3åˆ†é’Ÿå°±èƒ½ç”Ÿæˆå®Œæ•´çš„è‹±æ–‡å­—å¹•

- [Whisperx](https://github.com/m-bain/whisperX) ä½œè€…åˆ©ç”¨wav2vecæ¨¡å‹åˆ†åˆ«è§£å†³äº†whisperçš„å¹»å¬å’Œå•è¯åœå†™ä¸å¤Ÿå‡†ç¡®çš„é—®é¢˜ï¼Œæ”¹è¿›åå¯ä»¥å®ç°å•è¯åœ¨é€ç§’å°ºåº¦ä¸Šçš„å‡†ç¡®

- æ€»ç»“è‹±æ–‡æ–­å¥è§„å¾‹å’Œnltkç­‰è‡ªç„¶è¯­è¨€å·¥å…·ï¼Œå®ç°äº†å¯¹è¾ƒé•¿è‹±æ–‡å¥å­çš„è‡ªåŠ¨æ–­å¥ï¼Œå¯ä»¥åœ¨ä¸å½±å“ç¿»è¯‘çš„æƒ…å†µä¸‹ï¼Œè¾¾åˆ°å¯¹70%çš„è‹±æ–‡é•¿å¥çš„å‡†ç¡®æ–­å¥ï¼Œå¤§å¹…å‡å°‘åæœŸæ‰“è½´çš„å·¥ä½œé‡

- ä½¿ç”¨å¸¸è§çš„[Ollama](https://github.com/ollama/ollama)æœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼Œèƒ½å¤Ÿå®ç°ç”Ÿæˆè‹±æ–‡å­—å¹•çš„é«˜å‡†ç¡®ç¿»è¯‘ï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ä¸­æ–‡å­—å¹•ã€‚åŒæ—¶ä¹Ÿå¼€æ”¾äº†å¯¹è¿œç¨‹å¤§è¯­è¨€æ¨¡å‹çš„æ”¯æŒï¼Œèƒ½å¤Ÿå®ç°æ›´å¿«ï¼Œæ›´å‡†ç¡®çš„æ‰¹é‡ç¿»è¯‘(batch translation), **å¼ºçƒˆæ¨èä½¿ç”¨**ã€‚åŒæ—¶æ‰¹é‡ç¿»è¯‘æ¨¡å¼ä¸‹ï¼Œå…·å¤‡ä¸Šä¸‹æ–‡è®°å¿†èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ›´åŠ å‡†ç¡®åœ°ç¿»è¯‘å¥å­

## ä½¿ç”¨ä½“éªŒï¼š

transcribe(å¬å†™)æ•´ä¸ªæµç¨‹ä¸€èˆ¬æ§åˆ¶åœ¨ä¸¤åˆ†é’Ÿä»¥å†…, 30åˆ†é’Ÿä»¥ä¸Šçš„è§†é¢‘å¯èƒ½æ—¶é—´ä¼šæ›´ä¹…ã€‚

ç¿»è¯‘è€—æ—¶ï¼š

æ‰¹é‡ç¿»è¯‘æ¨¡å¼ çº¦ä¸ºè§†é¢‘æ—¶é•¿çš„äº”åˆ†ä¹‹ä¸€å·¦å³ã€‚
é€å¥ç¿»è¯‘æ¨¡å¼ çº¦ä¸ºè§†é¢‘æ—¶é•¿çš„ä¸‰åˆ†ä¹‹ä¸€å·¦å³ã€‚
å…·ä½“æ•ˆæœå–å†³äºæ¨¡å‹è‡ªèº«ã€‚

### æ•ˆæœï¼š

<div align=center>
<img src="./misc/rag_ibm.png" alt="rag_ibm.png" width="80%" height="80%">
</div>

<div align=center>
<img src="./misc/xelite.png" alt="xelite.png" width="80%" height="80%">
</div>

<div align=center>
<img src="./misc/xelite2.png" alt="xelite2.png" width="80%" height="80%">
</div>


---

> éƒ¨åˆ†æ— æ³•åˆ†è§£çš„é•¿å¥æ•ˆæœï¼š


<div align=center>
<img src="./misc/pcworld1.png" alt="pcworld2.png" width="80%" height="80%">
</div>


**è§†é¢‘æ•ˆæœå‚è€ƒï¼š**

[ä»€ä¹ˆæ˜¯RAG æ£€ç´¢å¢å¼ºç”Ÿæˆ ã€What_is_Retrieval_Augmented_Generation_RAGã€‘](https://www.bilibili.com/video/BV1Kf421d7kj/?vd_source=fc60a3443b9b14ad9f2afef0ca8b093c)


## é…ç½®éœ€æ±‚ï¼š

ä¸€å¼ èƒ½å¤Ÿè¿è¡ŒCUDAçš„Nvidia æ˜¾å¡ï¼Œå…·ä½“é…ç½®éœ€æ±‚å‚è€ƒwhisperè¦æ±‚

2-10GB æ˜¾å­˜çš„æ˜¾å¡åº”è¯¥éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆ2Gbä»¥ä¸‹çš„æš‚æœªæµ‹è¯•è¿‡ã€‚

whisperæ¨¡å‹å…±æœ‰5ä¸ªå¤§å°ï¼Œä½“ç§¯è¶Šå¤§ï¼Œtranscribeç²¾åº¦è¶Šé«˜ï¼Œè¯·æ ¹æ®ä½ çš„æ˜¾å¡é€‰æ‹©åˆé€‚çš„æ¨¡å‹ã€‚

|  Size  | Parameters | English-only model | Multilingual model | Required VRAM | Relative speed |
| :----: | :--------: | :----------------: | :----------------: | :-----------: | :------------: |
|  tiny  |    39 M    |     `tiny.en`      |       `tiny`       |     ~1 GB     |      ~32x      |
|  base  |    74 M    |     `base.en`      |       `base`       |     ~1 GB     |      ~16x      |
| small  |   244 M    |     `small.en`     |      `small`       |     ~2 GB     |      ~6x       |
| medium |   769 M    |    `medium.en`     |      `medium`      |     ~5 GB     |      ~2x       |
| large  |   1550 M   |        N/A         |      `large`       |    ~10 GB     |       1x       |

é»˜è®¤ä½¿ç”¨çš„æ˜¯å¯¹åº”çš„faster whisper large_v2æ¨¡å‹ã€‚


å¯¹äºå°æ˜¾å­˜çš„æ˜¾å¡ï¼Œä¹Ÿæ¨èä½¿ç”¨huggingfaceä¸Šwhisperè’¸é¦æ¨¡å‹ï¼Œåœ¨å°½å¯èƒ½çš„ä¿ç•™large v3 æ¨¡å‹çš„ç²¾åº¦çš„å‰æä¸‹ï¼ŒæŠŠæ˜¾å­˜çš„ä½¿ç”¨é‡ä»10GBé™ä½åˆ°5GBå·¦å³ã€‚

[**distil-whisper**](https://github.com/huggingface/distil-whisper)

| Model                                                                      | Params / M | Rel. Latency â†‘ | Short-Form WER â†“ | Long-Form WER â†“ |
|----------------------------------------------------------------------------|------------|----------------|------------------|-----------------|
| [large-v3](https://huggingface.co/openai/whisper-large-v3)                 | 1550       | 1.0            | **8.4**          | 11.0            |
| [large-v2](https://huggingface.co/openai/whisper-large-v2)                 | 1550       | 1.0            | 9.1              | 11.7            |
|                                                                            |            |                |                  |                 |
| [distil-large-v3](https://huggingface.co/distil-whisper/distil-large-v3)   | 756        | 6.3            | 9.7              | **10.8**        |
| [distil-large-v2](https://huggingface.co/distil-whisper/distil-large-v2)   | 756        | 5.8            | 10.1             | 11.6            |
| [distil-medium.en](https://huggingface.co/distil-whisper/distil-medium.en) | 394        | **6.8**        | 11.1             | 12.4            |
| [distil-small.en](https://huggingface.co/distil-whisper/distil-small.en)   | **166**    | 5.6            | 12.1             | 12.8            |


#### ç¿»è¯‘ï¼š
é¡¹ç›®æä¾›äº†Ollamaæ¨¡å‹æ”¯æŒï¼Œç¿»è¯‘çš„å‡†ç¡®åº¦ï¼Œé€Ÿåº¦ä¾GPUæ€§èƒ½ æ¨¡å‹æ€§èƒ½è€Œå®šã€‚

> [!NOTE]
> å¯¹äºæœ¬åœ°LLMæ¨¡å‹ï¼Œè‡³å°‘éœ€è¦èƒ½å¤Ÿè¿è¡Œ14Bä»¥ä¸Šå¤§å°ï¼Œå¦åˆ™å®Œå…¨æ— æ³•ä¿è¯ç¿»è¯‘çš„è´¨é‡ã€‚

æœ¬åœ°æ¨¡å‹å»ºè®®ä½¿ç”¨å•å¥ç¿»è¯‘æ¨¡å‹ï¼Œæ‰¹é‡ç¿»è¯‘éœ€è¦110bä»¥ä¸Šçš„æ¨¡å‹ã€‚


> ä½œè€…æ¨èä½¿ç”¨é˜¿é‡Œçš„qwen 1.5 chatç³»åˆ— æ¨¡å‹ï¼Œqwen 1.5 32b é‡åŒ–æ¨¡å‹åœ¨3090ä¸Šè¡¨ç°è‰¯å¥½ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°å®ç°å•å¥å‡†ç¡®ç¿»è¯‘ã€‚


[**qwen 1.5 chat**](https://github.com/langchain-ai/langchain/assets/1011680/f0f0d0c9-f0f0-4f0f-8f0f-8f0f8f0f8f0f)

> [!NOTE]
>å¯¹äºéœ€è¦é«˜å‡†ç¡®åº¦å’Œæ‰¹é‡ç¿»è¯‘çš„ç”¨æˆ·ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹APIï¼Œæ€§èƒ½è¿œè¶…æœ¬åœ°æ¨¡å‹ã€‚


> [!WARNING]
>batch translation éœ€è¦å¤§è¯­è¨€æ¨¡å‹èƒ½å¤Ÿå¯¹è‡ªå·±çš„è¾“å‡ºæ ¼å¼æœ‰ä¸¥æ ¼çš„æ§åˆ¶èƒ½åŠ›ï¼Œ**æ— æ³•æ§åˆ¶è¾“å‡ºæ ¼å¼çš„æ¨¡å‹å°½é‡ä¸è¦ä½¿ç”¨**
>batch translation é€Ÿåº¦æ˜¯é€å¥ç¿»è¯‘çš„3-5å€é€Ÿåº¦ï¼Œä¸”æ›´åŠ èŠ‚çœtokensã€‚

> ä½œè€…æ¨èä½¿ç”¨é˜¿é‡Œçš„qwen plusæ¨¡å‹ï¼Œqwen pluså®ç°äº†åœ¨ç¿»è¯‘è´¨é‡ã€apiä»·æ ¼ã€ç¿»è¯‘é€Ÿåº¦ä¸Šçš„å®Œç¾å¹³è¡¡ã€‚

[**Qwen plus API**](https://help.aliyun.com/zh/dashscope/developer-reference/model-introduction?spm=a2c4g.11186623.0.0.746b46c1FXZPd1)

## ä½¿ç”¨æ–¹æ³•

### 1.ä¸‹è½½æºç 

gitå‘½ä»¤cloneæºç 

```
git clone https://github.com/hiddenblue/whisperx_Sub.git`
```

 cd è¿›å…¥æºç ç›®å½•`

```
cd whisperx_sub`
```

é¦–å…ˆæ ¹æ®**requirements.txt** å®‰è£…ä¾èµ–

### 2.craete a virtual environment with Python 3.10
```
conda create -n whisperx_sub python==3.10
```

```
conda activate whisperx_sub
```

### 3. Install otherr dependency in requirements.txt

*You need install Nvidia drivers for your GPU*

```
pip install -r requirements.txt
```


### 4.é…ç½®ï¼š

è¿è¡Œå‰éœ€è¦åœ¨**config.py**æ–‡ä»¶å½“ä¸­é…ç½®è¿è¡Œéœ€è¦çš„ç›¸å…³ä¿¡æ¯

å¡«å…¥ç›®æ ‡éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„ï¼Œtaskç±»å‹ï¼Œtranslation ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹ç›¸å…³çš„apiä¿¡æ¯ã€‚

#### transcribe å‚è€ƒé…ç½®ï¼š

```
# task type
# task could be "transcribe" or "all"

task = "transcribe"

# transcribe parameters

# éœ€è¦ä½ é…ç½®çš„ä¸€äº›å˜é‡
# éŸ³é¢‘æˆ–è€…è§†é¢‘æ–‡ä»¶è·¯å¾„
audio_file = "./openai_sample.mp3"
```

å…¶ä¸­æœ€é‡è¦çš„æ˜¯é…ç½®å¡«å…¥éœ€è¦å¤„ç†çš„éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„ã€‚

task type å·¥ä½œæ¨¡å¼æœ‰ä¸¤ç§ï¼Œé»˜è®¤åªè¿›è¡Œtranscribe
1. **transcribe**  åªå¯¹éŸ³é¢‘æ–‡ä»¶è¿›è¡Œå¬å†™æ“ä½œã€‚ 

2. **all** åˆ™å…ˆåå¯¹éŸ³é¢‘æ–‡ä»¶è¿›è¡Œå¬å†™ï¼Œç„¶ååˆ©ç”¨LLMè¿›è¡Œç¿»è¯‘ï¼Œéœ€è¦é¢å¤–é…ç½®ç¿»è¯‘å‚æ•°ã€‚

#### translation å‚è€ƒé…ç½®ï¼š

åœ¨é…ç½®å¥½transcribeå‚æ•°çš„åŸºç¡€ä¸Šï¼Œéœ€é…ç½®ä¸€ä¸ªå¯ä»¥è°ƒç”¨çš„å¤§è¯­è¨€æ¨¡å‹

config.py æ–‡ä»¶å½“ä¸­è¿›è¡Œé…ç½®

```
# subtitle translation parameters

is_using_local_model = False  # æ˜¯å¦ä½¿ç”¨æœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼Œé»˜è®¤ä¸ºFalse

base_url = "http://localhost:11434/api/chat"    # ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹apiï¼Œæœ¬åœ°æˆ–è€…è¿œç¨‹

translation_model_name = "qwen:32b-chat-v1.5-q5_K_M"  # LLMæ¨¡å‹api

translation_prompt = ""    # ç¿»è¯‘å­—æ¯æ—¶éœ€è¦ç”¨åˆ°çš„promptæç¤ºè¯ï¼Œé»˜è®¤å¯ä»¥ä¸ºç©ºï¼Œå†…ç½®æç¤ºè¯äº†

srt_file_name = ""   éœ€è¦å•ç‹¬è°ƒç”¨ ç¿»è¯‘æ¨¡å¼æ—¶éœ€è¦æŒ‡å®šçš„srtæ–‡ä»¶è·¯å¾„
```

### è¿è¡Œ

ç›´æ¥åœ¨terminalæˆ–è€…å‘½ä»¤è¡Œå½“ä¸­æ‰§è¡Œwhisperx_sub.pyæ–‡ä»¶ï¼Œæˆ–è€…åœ¨IDEä¸­æ‰§è¡Œ

```
python whisperx_sub.py
```

å½“çœ‹åˆ°å‘½ä»¤è¡Œè¾“å‡ºä¸€ç³»åˆ—ä¿¡æ¯åï¼Œè¯´æ˜ç¨‹åºå¼€å§‹æ‰§è¡Œäº†

æ ¹æ®éœ€è¦transcribeçš„è§†é¢‘çš„æ—¶é—´ï¼Œç­‰å¾…30s-3minåå°±èƒ½å¾—åˆ°å¬å†™å¥½çš„å­—å¹•æ–‡ä»¶

###  è¾“å‡ºæ–‡ä»¶

æœªç»é•¿å¥åˆ†å‰²çš„å­—å¹•æ–‡ä»¶ä½äºoutputæ–‡ä»¶å¤¹ä¸‹ã€‚

output/cutç›®å½•ä¸‹æ˜¯ç»è¿‡é•¿å¥åˆ†å‰²çš„å­—å¹•æ–‡ä»¶ã€‚

ç¿»è¯‘å¾—åˆ°çš„å­—å¹•æ–‡ä»¶ä¸ºéŸ³é¢‘æ–‡ä»¶åå­— +CN-ZH.srtæ–‡ä»¶ï¼Œä½äºoutputç›®å½•å½“ä¸­ã€‚

```
â”œâ”€â”€ output
â”‚Â Â  â”œâ”€â”€ cut
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ openai_sample.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ openai_sample.srt
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ openai_sample.tsv
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ openai_sample.txt
â”‚Â Â  â”‚Â Â  â””â”€â”€ openai_sample.vtt
â”‚Â Â  â”œâ”€â”€ openai_sample.json
â”‚Â Â  â”œâ”€â”€ openai_sample.srt
â”‚Â Â  â”œâ”€â”€ openai_sample.tsv
â”‚Â Â  â”œâ”€â”€ openai_sample.txt
â”‚Â Â  â””â”€â”€ openai_sample.vtt
```


## Todo 

- æ›´å¤šçš„è¯­è¨€æ”¯æŒï¼Œç›®å‰åªæ”¯æŒè‹±æ–‡ï¼ˆä½œè€…åªä¼šè‹±è¯­
- æ›´å¼ºçš„é•¿å¥æ–­å¥èƒ½åŠ›ï¼Œç›®å‰é€šè¿‡æ‰‹å·¥åˆ†æåªèƒ½è§£å†³70%çš„æ–­å¥é—®é¢˜
- å›¾å½¢åŒ–ç•Œé¢ï¼Œéœ€è¦ä¸€ä¸ªGUIæ¥é™ä½ä½¿ç”¨é—¨æ§›ï¼Œæ–¹ä¾¿å¹¿å¤§ç”¨æˆ·
- ä¿®å¤ whisperxè‡ªèº«çš„ä¸€äº›é”™è¯¯ï¼Œæé«˜transcribeçš„è´¨é‡


## License ğŸ“œ

This project is licensed under the [GPL-3.0 license](LICENSE) - see the [LICENSE](LICENSE) file for details. ğŸ“„


## æ›´æ–°æ—¥å¿—



## å‚è€ƒçš„é¡¹ç›®
1. [**Whisper**](https://github.com/openai/whisper)

2. [**Faster-whisper**](https://github.com/SYSTRAN/faster-whisper)

3. [**Whisperx**](https://github.com/m-bain/whisperX)

4. [**deepmultilingualpunctuation**](https://github.com/oliverguhr/deepmultilingualpunctuation)
